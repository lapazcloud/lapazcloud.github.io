<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.73.0"><title>Integracion Continua Laboratorio | La Paz Cloud</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Integracion Continua Laboratorio"><meta name=twitter:description content="¿Qué es DevOps? &ldquo;DevOps es la union de personas, procesos y productos para lograr la entrega de valor continuo para los usuarios finales&rdquo; Donovan Brown - Principal DevOps Manager Microsoft
¿Qué es Integración Contínua (CI)? La Integración Continua (Continuous Integration CI) es una práctica que incrementa la eficacia y la eficiencia de los resultados del equipo de desarrolladores.
Consiste en combinar los cambios realizados en el código del proyecto, en un repositorio central de forma periódica, para luego ejecutar pruebas y detectar y reparar errores lo antes posible."><meta property="og:title" content="Integracion Continua Laboratorio"><meta property="og:description" content="¿Qué es DevOps? &ldquo;DevOps es la union de personas, procesos y productos para lograr la entrega de valor continuo para los usuarios finales&rdquo; Donovan Brown - Principal DevOps Manager Microsoft
¿Qué es Integración Contínua (CI)? La Integración Continua (Continuous Integration CI) es una práctica que incrementa la eficacia y la eficiencia de los resultados del equipo de desarrolladores.
Consiste en combinar los cambios realizados en el código del proyecto, en un repositorio central de forma periódica, para luego ejecutar pruebas y detectar y reparar errores lo antes posible."><meta property="og:type" content="article"><meta property="og:url" content="https://lapazcloud.com/docs/integracion-continua-laboratorio/"><meta property="article:published_time" content="2020-01-28T19:27:23-04:00"><meta property="article:modified_time" content="2020-01-28T19:27:23-04:00"><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css rel=stylesheet integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel=stylesheet><link href=/css/medium.css rel=stylesheet><link href=/css/additional.css rel=stylesheet></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand href=https://lapazcloud.com//><span style=font-family:Righteous>La Paz Cloud</span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/blog>Blog</a></li><li class=nav-item><a class=nav-link href=/nosotros>Nosotros</a></li><li class=nav-item><a class=nav-link href=/docs>Documentacion</a></li></ul></div></div></nav><div class=site-content><div class=container><div class=main-content><div class=container><div class=row><div class=col-md-1></div><div class=col-md-10><div class=mainheading></div><div class=article-post><h1 id=qué-es-devops>¿Qué es DevOps?</h1><p>&ldquo;DevOps es la union de personas, procesos y productos para lograr la entrega de valor continuo para los usuarios finales&rdquo; Donovan Brown - Principal DevOps Manager Microsoft</p><h1 id=qué-es-integración-contínua-ci>¿Qué es Integración Contínua (CI)?</h1><p>La Integración Continua (Continuous Integration CI) es una práctica que incrementa la eficacia y la eficiencia de los resultados del equipo de desarrolladores.</p><p>Consiste en combinar los cambios realizados en el código del proyecto, en un repositorio central de forma periódica, para luego ejecutar pruebas y detectar y reparar errores lo antes posible.</p><h3 id=integración-y-entrega-continuas-cicd>Integración y entrega continuas (CI/CD)</h3><p>La integración continua es una práctica de desarrollo de software en la que los desarrolladores fusionan mediante combinación los cambios de código en la rama de código principal con frecuencia. En la integración continua se utilizan pruebas automáticas, que se ejecutan cada vez que se hace “commit” de código nuevo. De este modo, el código de la rama principal siempre es estable.</p><h1 id=objetivo>Objetivo</h1><p>AL finalizar esta guia podras tener tus propio gitlab configurado para que cada vez que se haga un commit de codigo nuevo en la rama <em>dev</em> se ejecuten pruebas automaticas.</p><p>Revisa estos links si tienes dudas:
<a href=https://www.udemy.com/course/devops-las-artes-marciales-del-software/>Curso Udemy DevOps - Las Artes Marciales del Software</a>
<a href=https://azure.microsoft.com/es-es/overview/what-is-devops/>¿Qué es DevOps? Microsoft Azure</a></p><h1 id=manos-a-la-obra>Manos a la obra</h1><ul><li>Cuenta en gitlab.com (Con ella podrás ejecutar Gitlab CI hasta 2000 minutos al mes.)</li><li><a href=./integracion-continua-laboratorio/ejemplo-ci.zip>Proyecto</a></li><li>Configuracion</li></ul><ul><li>Archivo .gitlab-ci.yml</li></ul><ul><li>Ejecutando las pruebas en Gitlab CI</li></ul><h2 id=configuración>Configuración</h2><p>Para hacer que <strong>Gitlab CI</strong> reconozca nuestras pruebas y las ejecute debemos configurar nuestro proyecto agregando un archivo <strong>.gitlab-ci.yml</strong>:</p><h2 id=archivo-gitlab-ciyml>Archivo .gitlab-ci.yml</h2><p><strong>.gitlab-ci.yml</strong> es un archivo de configuración <strong>YAML</strong> que debes crear en la raíz de tu proyecto, con el siguiente contenido.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>image</span>: node:<span style=color:#ae81ff>13.7.0</span>
<span style=color:#66d9ef>stages</span>:
    - test-dev

<span style=color:#66d9ef>cache</span>:
    <span style=color:#66d9ef>paths</span>:
        - node_modules

<span style=color:#66d9ef>before_script</span>:
  - npm install
  - npm install -g jest

<span style=color:#66d9ef>test-dev</span>:
    <span style=color:#66d9ef>stage</span>: test-dev
    <span style=color:#66d9ef>script</span>:
        - npm test
</code></pre></div><p>Analicemos un poco este archivo:</p><p><strong>image: node:13.7.0</strong> le indicamos cuál imagen de Docker usará Gitlab para ejecutar las pruebas.</p><p><strong>stages</strong> es la secuencia de pasos en los que se ejecutaran los jobs (tareas).</p><p><strong>cache</strong> podemos establecer cuales archivos y carpetas serán guardarán en cache.</p><p><strong>before_script</strong> definimos el conjunto de comandos que se ejecutarán antes de que las pruebas sean ejecutadas. Para nuestro proyecto de <strong>nodejs</strong> necesitamos instalar las dependencias de la aplicación y realizar las configuraciones necesarias para que la app funcione correctamente.</p><p><strong>test-dev</strong> es el job o trabajo que se va a ejecutar en <strong>Gitlab Runner</strong> y los comandos están definidos en <strong>script</strong>.</p><p><a href=https://docs.gitlab.com/ce/ci/yaml/README.html>Documentacion Yaml</a></p><h1 id=archivo-de-pruebas>Archivo de pruebas</h1><p>Las prubas se encuentran dentro el archivo test/sample.test.js</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../app.js&#39;</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>supertest</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;supertest&#39;</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>request</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>supertest</span>(<span style=color:#a6e22e>app</span>)

<span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;GET /&#39;</span>, () =&gt; {
  <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;gets the test endpoint&#39;</span>, <span style=color:#a6e22e>async</span> <span style=color:#a6e22e>done</span> =&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>await</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>);
    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span>).<span style=color:#a6e22e>toBe</span>(<span style=color:#ae81ff>200</span>)
    <span style=color:#75715e>//Search especific text in the response
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>text</span>.<span style=color:#a6e22e>search</span>(<span style=color:#e6db74>&#34;Node.js Express Application&#34;</span>);
    <span style=color:#75715e>// if position = -1 =&gt; text not found
</span><span style=color:#75715e></span>    <span style=color:#75715e>// if position &gt;= 0 =&gt; text found
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>position</span> <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>).<span style=color:#a6e22e>toBe</span>(<span style=color:#66d9ef>false</span>)
    <span style=color:#a6e22e>done</span>()
  })
})
</code></pre></div><p>Este test es simple, busca la cadena</p><pre><code>Node.js Express Application
</code></pre><h1 id=ejecutando-las-pruebas-en-gitlab-ci>Ejecutando las pruebas en Gitlab CI</h1><p>Ahora procede a hacer el commit del proyecto y git push para subir los cambios al repositorio.
<img src=https://i.imgur.com/HvhNbIv.png alt></p><p>Puedes ver estado del <strong>pipeline</strong> desde la opción <strong>CI/CD -> Pipelines</strong>, veras algo como:
*Un pipeline es un flujo de trabajo
<img src=https://i.imgur.com/xWYl30H.png alt></p><p>Si todo salio bien, veremos algo similar:
<img src=https://i.imgur.com/acRNtmn.png alt></p><p>En caso de fallo, veremos algo similar:
<img src=https://i.imgur.com/gt91thY.png alt></p><p>Para probar el funcionamiento de <strong>CI</strong>, edita el arhivo de pruebas <strong>test/sample.test.js</strong></p><p>Desarrollar usando integración continua en nuestros proyectos es realmente beneficioso pues no necesitarías dedicarle mucho tiempo a probar el código cada vez que integras una nueva funcionalidad. Es bastante útil cuando se trabaja en equipos de desarrollo donde sus integrantes pueden no estar al tanto de todos los cambios y características del proyecto.</p></div></div><div class=col-md-1></div></div></div></div></div><footer class=footer><div class=container><div class=row><div class="col-md-6 col-sm-6 text-center text-lg-left">&copy; Copyright Comunidad La Paz Cloud</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a target=_blank rel=noopener href=https://www.wowthemes.net>Mediumish Theme</a> by WowThemes.net</div></div></div></footer></div><script src=https://code.jquery.com/jquery-3.4.1.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js integrity=sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script><script src=/js/mediumish.js></script></body></html>